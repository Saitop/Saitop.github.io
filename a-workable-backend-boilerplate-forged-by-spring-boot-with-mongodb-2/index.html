
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>A workable backend boilerplate forged by Spring Boot and MongoDB</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=b6f7a62efa">


    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="Lam, Hon-Yin">
    <meta property="og:type" content="article">
    <meta property="og:title" content="A workable backend boilerplate forged by Spring Boot and MongoDB">
    <meta property="og:description" content="Foreword: It's not for veteran or magical wizard :)  This article is a quick and practical introduction to use Spring Boot and MongoDB to build a server side application . Recently I had to build a RESTful backend (or server, call it whatever you want, and REST is not the subject of">
    <meta property="og:url" content="http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/">
    <meta property="article:published_time" content="2016-11-27T09:28:18.000Z">
    <meta property="article:modified_time" content="2017-01-26T08:30:33.000Z">
    <meta property="article:tag" content="mongoDB">
    <meta property="article:tag" content="Spring Boot">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="A workable backend boilerplate forged by Spring Boot and MongoDB">
    <meta name="twitter:description" content="Foreword: It's not for veteran or magical wizard :)  This article is a quick and practical introduction to use Spring Boot and MongoDB to build a server side application . Recently I had to build a RESTful backend (or server, call it whatever you want, and REST is not the subject of">
    <meta name="twitter:url" content="http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Lam, Hon-Yin">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="mongoDB, Spring Boot">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Lam, Hon-Yin",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Lam, Hon-Yin",
        "url": "http://localhost:2368/author/lam/",
        "sameAs": []
    },
    "headline": "A workable backend boilerplate forged by Spring Boot and MongoDB",
    "url": "http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/",
    "datePublished": "2016-11-27T09:28:18.000Z",
    "dateModified": "2017-01-26T08:30:33.000Z",
    "keywords": "mongoDB, Spring Boot",
    "description": "Foreword: It&#x27;s not for veteran or magical wizard :)  This article is a quick and practical introduction to use Spring Boot and MongoDB to build a server side application . Recently I had to build a RESTful backend (or server, call it whatever you want, and REST is not the subject of",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 1.0">
    <link rel="alternate" type="application/rss+xml" title="Lam, Hon-Yin" href="http://localhost:2368/rss/">
</head>
<body class="post-template tag-mongodb tag-spring-boot nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home"><a href="../">Home</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="../rss/index.rss">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-mongodb tag-spring-boot">

        <header class="post-header">
            <h1 class="post-title">A workable backend boilerplate forged by Spring Boot and MongoDB</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-11-27">27 November 2016</time>  on <a href="../tag/mongodb/">mongoDB</a>, <a href="../tag/spring-boot/">Spring Boot</a>
            </section>
        </header>

        <section class="post-content">
            <div class="kg-card-markdown"><p><strong>Foreword:<br>
It's not for veteran or magical wizard :)  This article is a quick and practical introduction to use Spring Boot and MongoDB to build a server side application .</strong></p>
<p>Recently I had to build a <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> backend (or server, call it whatever you want, and REST is not the subject of this article) to support a mobile app, using Spring Boot and MongoDB for some reasons. Neither Spring Boot nor MongoDB is my thing, so building a backend with them from scratch is kind of suffering. Since the tutorials out there are either fragmented or obscure, here I will offer a minimum-viable (Spring Boot + MongoDB) backend so as to get rid of the noise which will confuse a newbie.<br>
I always believe that knowing too much useless details at the very beginning of the course to master a new tech is not gonna help but frustrating. On the contrary, ramping your knowledge up step by step based on a practical sample is much easier. The following sample is a good start point for beginners to learn both <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> and <a href="https://www.mongodb.com/">Mongo</a>.</p>
<p>Our goal is to create a workable backend that accept HTTP request and change the state of MongoDB, in other word, do a data persistence in database.<br>
No more chatting, take a deep breath and dive.</p>
<h3 id="overview">Overview</h3>
<p>Our project structure will eventually looks like this:</p>
<pre><code>demo
├── build.gradle
└── src
    └── main
        ├── java
           └── com
               └── demo
                   ├── Application.java
                   ├── config
                   │   └── MongoConfig.java
                   ├── controller
                   │   ├── AccountController.java
                   │   └── hateverController.java
                   ├── model
                   │   ├── Account.java
                   │   ├── SignUpRequest.java
                   │
                   │   
                   ├── repository
                   │   └── AccountRepository.java
                   └── service
                       └── AccountService.java
        

</code></pre>
<p>Hand on, you don't have to create each file manually. The magicians of Spring offer you something like this:</p>
<p><img src="../content/images/2016/11/Screen-Shot-2016-11-26-at-16.39.15.png" alt="boostrap the Spring appliation"><br>
It's a <a href="https://start.spring.io/">boostrap tool for Spring application</a>. You can type you project name in <code>Artifact</code>, type and select <code>MongoDB</code> in the the feild of <code>Dependencies</code>, and select your build tool as <code>Gradle Project</code> on the top.  After click <code>Generate Project</code>, you will get a project with the similar structure to our demo application. All you need to do is to flesh out the project skeleton with the upcoming codes.</p>
<h3 id="gradleconfiguration">Gradle Configuration</h3>
<p>I am not going into details of every tool we use for the sake of simplicity. And like I said, you don't need to know every details at the beginning.<br>
So edit the file <code>build.gradle</code> in the demo project and make it like this:</p>
<p><em>build.gradle</em></p>
<pre><code>group 'com.demo'
version '1.0-SNAPSHOT'

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE")
    }
}

apply plugin: 'idea'
apply plugin: 'java'
apply plugin: 'spring-boot'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    compile group: 'org.projectlombok', name: 'lombok', version: '1.16.10'
    compile group: 'org.springframework.boot', name: 'spring-boot-starter-web', version: '1.4.0.RELEASE'
    compile 'org.mongodb:mongodb-driver:3.3.0'
    compile 'org.springframework.data:spring-data-mongodb:1.9.4.RELEASE'
    testCompile group: 'junit', name: 'junit', version: '4.11'
    testCompile group: 'org.springframework.boot', name: 'spring-boot-starter-test', version: '1.4.0.RELEASE'
}
</code></pre>
<p>This file is a blueprint to build the application, which specify the version of your application, the version of programming language (we use Java 1.8 here), the IDE support tool(I use idea), the dependencies the application will need, and where to grab these dependencies. <a href="https://gradle.org/">Gradle</a>, a build tool and a package manager, will handle all these things if there is a file called <code>build.config</code> in the root directory.</p>
<h3 id="mongoconfiguration">Mongo Configuration</h3>
<p>Now it's time to set up the engine of our application, the MongoDB. Spring provides a package, <code>org.springframework.data</code>, to make it easy to use data access technologies. If you take a careful look at the the <code>build.gradle</code> file, you will find out we already integrate the MongoDB module into our project.</p>
<p>To connect to MongoDB, this file is needed:</p>
<p><em>MongoConfig.java</em></p>
<pre><code>package com.demo.config;

import com.mongodb.Mongo;
import com.mongodb.MongoClient;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.mongodb.config.AbstractMongoConfiguration;
import org.springframework.data.mongodb.repository.config.EnableMongoRepositories;

@Configuration
@EnableMongoRepositories(basePackages = "com.demo.repository")
public class MongoConfig extends AbstractMongoConfiguration {

    //this is where you specify your database's name
    @Override
    protected String getDatabaseName() {
        return "test"; 
    }

    @Override
    public Mongo mongo() throws Exception {
        return new MongoClient("127.0.0.1", 27017);
    }

    @Override
    public String getMappingBasePackage() {
        return "com.demo";
    }

}
</code></pre>
<p>Of course, you can use <code>application.properties</code> to config the database if you want. It's another way to make Spring-associated configuration, which I think it's not so straightforward and flexible as Java-based config.</p>
<p>However, a specification file is not enough to boot up an engine, you still need to install the engine itself, MongoDB, into your system. About the installation, please refer to <a href="https://docs.mongodb.com/v3.0/tutorial/install-mongodb-on-os-x/">Install MongoDB</a>. I prefer the manual installation way other than the <code>brew</code> way. If so do you, this guide is clearer, <a href="https://www.mkyong.com/mongodb/how-to-install-mongodb-on-mac-os-x/">How to install MongoDB on Mac OS X</a>.</p>
<p>After all these boring setups, you can start the database by this command:</p>
<pre><code>$ mongod
</code></pre>
<p>That's all you need to connect to MongoDB, but I still want to recommend you the GUI for MongoDB, <a href="https://www.mongodb.com/products/compass">MongoDB Compass</a>. "The Easiest Way to Explore and Manipulate Your MongoDB Data", like it said.</p>
<h3 id="thedomainmodel">The Domain Model</h3>
<p>I forgot to mention that, we are going to implement a sign up function on the backend. So we need a <code>Account</code> object to hold the registrant's information, like this:</p>
<p><em>Account.java</em></p>
<pre><code>package com.demo.model;

import lombok.Data;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;

@Document
@Data
public class Account {
    @Id
    private String id;

    private String username;

    private String password;

    private String phone;

    private CountryCode countryCode;

    private String email;

}
</code></pre>
<p>With the annotation <code>@Document</code>, the framework will do a mapping between your POJO (Plain Old Java Object) to a MongoDB document. That's saying, when we save one instance of <code>Account</code>, the framework will create a document into the MongoDB, the process is so called data persistence, and that is the moral of all the story here.</p>
<p>But how we save the Java object to MongoDB?</p>
<p>We will need this:<br>
<em>AccountRepository.java</em></p>
<pre><code>package com.hanbang.repository;

import com.hanbang.model.Account;
import org.springframework.data.mongodb.repository.MongoRepository;

public interface AccountRepository extends MongoRepository&lt;Account, String&gt;{
} 

</code></pre>
<p>The <code>MongoRepository</code> offered by <code>org.springframework.data</code> contains a lot of common interfaces that will help interact with the database, like <code>save()</code> method we need.</p>
<p>For the sake of best practices, we usually create a service layer to separate the business logics and the interaction related to database. Somebody may has criticism of this, but we do it this way, create a service to save <code>Account</code> object to MongoDB:</p>
<p><em>AccountService.java</em></p>
<pre><code>import com.hanbang.model.Account;
import com.hanbang.repository.AccountRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class AccountService {

    @Autowired
    private AccountRepository accountRepository;

    public void save(Account account) {
        accountRepository.save(account);
    }
}
</code></pre>
<p>With that, when you call <code>accountService.save(account)</code> somewhere, the method <code>accountRepository.save(account)</code> will actually convert the Java object 'Account' to a document record.</p>
<h3 id="handlethehttprequest">Handle the HTTP request</h3>
<p>If you don't need to take a break, let's wrap up all these things now...</p>
<p>A controller in Spring is where the application accept HTTP request from frontend (A mobile app, or a browser) and return the result what frontend asked for.</p>
<p><em>AccountController.java</em></p>
<pre><code>package com.demo.controller;

import ...//importing stuff left out here, the IDE will help you, right? By the way, I use IntelliJ...

@Controller
@RequestMapping(value = "/account")
public class AccountController {

    private final AccountService accountService;

    @Autowired
    public AccountController(AccountService accountService) {
        this.accountService = accountService;
    }

    @RequestMapping(method= RequestMethod.POST, value = "/test", headers = "Accept=application/json")
    @ResponseBody
    public boolean testSave(@RequestBody SignUpRequest userInfo) {
        String phone = userInfo.getPhone();
        String countryCode = userInfo.getCountryCode();
        String email = userInfo.getEmail();

        Account account = new Account();
        account.setId("10000000000"); //still, for the reason of simplicity...
        account.setPhone(phone);
        account.setCountryCode(CountryCode.China);
        account.setEmail(email);
        accountService.save(account);
        return true;
    }
}

</code></pre>
<p>When you send a post request to the location '<a href="http://localhost:8080/account/test">http://localhost:8080/account/test</a>' with body like this:</p>
<pre><code>{
	"phone": "1111111111",
	"countryCode": "86",
	"email": "test@thoughtworks.com"
}
</code></pre>
<p>The controller will convert the JSON to an Java object, and then save it into MongoDB.</p>
<p>If you want Spring do the conversion automatically, the process as know as the deserialization, simply create a model to hold the JSON-like object:</p>
<p><em>SingUpRequest.java</em></p>
<pre><code>package com.demo.model;

import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import lombok.Data;
import lombok.NoArgsConstructor

@Data
@NoArgsConstructor
@JsonDeserialize
public class SignUpRequest {
    private String phone;
    private String countryCode;
    private String email;
}
</code></pre>
<p>A Java object with the annotation <code>@JsonDeserialize</code> can be deserialized from JSON or serialized as JSON, which will handled by Spring without your intervention.</p>
<p>Last but least, do not forget the main entry of our application:<br>
<em>Application.java</em></p>
<pre><code>package com.hanbang;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@ComponentScan("com.hanbang")
@EnableAutoConfiguration
public class Application {
    public static void main(String[] args){
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<p>Finally, to start the application, just run this command in terminal:</p>
<pre><code>gradle bootRun
</code></pre>
<h3 id="manualtest">Manual Test</h3>
<p>Send a post request with Postman:</p>
<p><img src="../content/images/2016/11/Screen-Shot-2016-11-27-at-17.05.22.png" alt="Send request with Postman"></p>
<p>Remember to add the header to request:<br>
'Content-Type: application/x-www-form-urlencoded'</p>
<p>Then you will see a document in MongoDB Compass:</p>
<p><img src="../content/images/2016/11/-MongoDBCompass-1.jpg" alt="MongoDB Compass result"></p>
<p>Hope that helps.</p>
</div>
        </section>

        <footer class="post-footer">



            <section class="author">
                <h4><a href="../author/lam/">Lam, Hon-Yin</a></h4>

                    <p>Read <a href="../author/lam/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=A%20workable%20backend%20boilerplate%20forged%20by%20Spring%20Boot%20and%20MongoDB&amp;url=http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/a-workable-backend-boilerplate-forged-by-spring-boot-with-mongodb-2/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="../export-json-data-as-excel-file-in-spring-framework/">
        <section class="post">
            <h2>Export JSON data as Excel file in Spring framework</h2>
            <p>How to transfer a JSON-like data to an Excel sheet? This is the most unreasonable requirements(sorry for the…</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="../how-to-construct-your-very-fist-react-app-with-webpack/">
        <section class="post">
            <h2>How to construct your very fist React app with Webpack</h2>
            <p>Prerequisite: the readers are assumed to have some basic knowledge about React, npm and ES2015(aka ES6). This article…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="../">Lam, Hon-Yin</a> © 2017</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=b6f7a62efa"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=b6f7a62efa"></script>

</body>
